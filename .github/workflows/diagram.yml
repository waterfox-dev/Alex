name: Diagram Generation CI 

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ] 

jobs:
    build: 

        runs-on: ubuntu-latest
        strategy:
            max-parallel: 4
            matrix:
              python-version: [3.11]
    
        steps:
        - uses: actions/checkout@v4
        - name: Set up Python ${{ matrix.python-version }}
          uses: actions/setup-python@v3
          with:
            python-version: ${{ matrix.python-version }}
        - name: Install Graphviz
          run: |
            sudo apt-get install graphviz
        - name: Install Dependencies
          run: |
            python -m pip install --upgrade pip
            pip install -r alex-api/requirements.txt
        - name: Generate Diagram
          run: |
            cd alex-api/api
            python manage.py graph_models -a -g -o ../doc/diagram/alex_database.png
        - name: Commit Diagram
          run: |
            git config --global user.email "github-actions[bot]@users.noreply.github.com"
            git config --global user.name "github-actions[bot]"
            git add doc/diagram/alex_database.png
            git commit -m "ðŸ¤– feat(API): Generate Django Database Diagram"
            git push